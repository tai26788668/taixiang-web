# 變更記錄

## [1.0.4] - 2026-02-13

### 🔧 改進

#### LINE Bot 請假顯示頁面優化
- **調整顯示範圍**：將「未來七日內(預約)請假」改為「明後天(預約)請假」
  - 只顯示明天和後天的請假記錄
  - 更聚焦於近期請假安排
  - 提升資訊的即時性和實用性

---

## [1.0.3] - 2026-02-13

### ✨ 新功能

#### LINE Bot 請假顯示頁面
- **新增 `/line/leave_display` endpoint**：網頁版請假記錄顯示
  - 顯示當前日期時間（yyyy/mm/dd hh:mm）
  - 分三個區塊顯示：
    - 今日(預約)請假：當日預約請假（不含臨時請假）
    - 今日(臨時)請假：當日臨時請假（申請日期=請假日期）
    - 明後天(預約)請假：明天和後天的請假記錄
  - 隱私保護：姓名第二個字改為 "O"
  - 手機版友善設計，簡潔清爽
  - 自動排除已退回記錄
  - **智慧分組顯示**：每個區塊內，同一人的多個請假時段會分組顯示，人名只顯示一次
  - URL: `https://taixiang-server.onrender.com/line/leave_display`

---

## [1.0.2] - 2026-02-12

### ✨ 新功能

#### LINE Bot 指令增強
- **新增 `list -w` 指令**：查詢未來 7 天內的請假記錄
  - 輸出格式：`預計(未來七日內)請假姓名 日期 開始 結束 假別`
  - 查無資料：`無人預約(未來7天內請假)`
- **新增 `list -t` 指令**：查詢臨時請假記錄（申請日期等於請假日期）
  - 輸出格式：`(今日)臨時請假姓名 日期 開始 結束 假別`
  - 查無資料：不回應任何訊息

### 🔧 改進

#### LINE Bot 指令優化
- **排除已退回記錄**：所有 list 指令（list、list -d、list -w、list -t）不再顯示簽核狀態為「已退回」的記錄
- **去除重複記錄**：自動移除顯示資訊完全相同的重複記錄，只保留一筆
- **更新輸出格式**：
  - `list -d`：改為 `預計(今日)請假姓名 日期 開始 結束 假別`
  - `list -w`：改為 `預計(未來七日內)請假姓名 日期 開始 結束 假別`
- **優化查無資料訊息**：
  - `list`：顯示「無人預約(請假)」
  - `list -d`：顯示「無人預約(今日請假)」
  - `list -w`：顯示「無人預約(未來7天內請假)」
  - `list -t`：不顯示任何訊息
- **更新 help 訊息**：`list -d //列出含當日以後請假 ;d當日請假;-w 7天內請假;-t 臨時請假`

### 📚 文件更新
- 更新 LINE Bot reply requirements 文件，反映最新的指令和驗收標準

---

## [1.0.1] - 2026-02-09

### 🔧 修正與改進

#### LINE Bot 指令簡化
- **移除 `-a` 簽核狀態相關指令**：
  - 移除 `list -a`（未來已簽核）
  - 移除 `list -d -a` 和 `list -a -d`（當日已簽核）
- **簡化輸出格式**：
  - `list` 和 `list -d` 指令不再顯示簽核狀態
  - 新格式：`預計請假姓名 日期 開始 結束 假別`
- **更新 help 訊息**：
  - 新的說明：`list -d //列出含當日以後請假 ;d當日請假`

#### 檔案路徑優化
- 所有程式統一從 Persistent Disk (`/mnt/data/`) 讀取 CSV 檔案
- 移除回退邏輯，確保生產環境資料一致性
- 測試環境使用 `test-data/` 目錄

#### 文件整合
- 整合部署相關文件到 `部署指南.md`
- 整合備份工具說明到 `緊急備份指南.md`
- 移除重複和過時的文件

#### CSV 檔案管理
- CSV 檔案重新命名為英文：
  - `請假系統個人資料.csv` → `personal_data.csv`
  - `請假記錄.csv` → `leave_records.csv`
- 改為手動上傳方式，移除自動上傳腳本
- 更新所有相關程式碼和文件

### 🗑️ 移除項目
- 移除自動上傳腳本和相關工具
- 移除診斷和檢查腳本
- 移除重複的部署文件
- 移除 `-a` 簽核狀態查詢指令

---

## [1.0.0] - 2026-02-06

### 🎉 初始發布

泰鄉食品系統 v1.0.0 正式發布！

### ✨ 主要功能

#### 主網站
- 響應式網站設計
- 產品展示與分類
- 公司歷史介紹
- 聯絡資訊頁面

#### 請假系統
- 員工登入與身份驗證
- 請假申請功能（特休、病假、事假、生理假等）
- 請假記錄查詢
- 管理者審核功能
- 密碼變更功能
- 多語言支援（繁體中文、英文、印尼文）

#### LINE Bot
- 自動回覆請假查詢
- 支援多種查詢指令：
  - `help?` - 顯示幫助訊息
  - `list` - 列出未來請假記錄
  - `list -d` - 列出當日請假記錄
  - `list -a` - 列出已簽核請假記錄
  - `list -d -a` - 列出當日已簽核請假記錄
  - `請假` - 顯示請假系統連結
  - `官網` - 顯示官網連結
- 請假申請自動通知
- 今日請假通知功能

#### 備份系統
- 緊急備份 API
- 週報郵件備份
- CSV 資料下載功能

### 🏗️ 技術架構

#### 前端
- React + TypeScript + Vite
- Tailwind CSS
- 響應式設計

#### 後端
- Node.js + Express + TypeScript
- CSV 檔案儲存
- LINE Messaging API
- Gmail SMTP 郵件服務

#### 部署
- Render 雲端平台
- Static Site (主網站)
- Web Service (後端服務)
- Persistent Disk (資料儲存)

### 📁 資料檔案

- `personal_data.csv` - 員工個人資料
- `leave_records.csv` - 請假記錄

### 🔒 安全性

- JWT Token 身份驗證
- 密碼加密
- CORS 跨域保護
- LINE Webhook 簽名驗證
- 緊急備份 API User-Agent 驗證

### 📚 文件

- 部署指南
- 緊急備份指南
- 週報設定說明
- LINE Bot 使用說明

---

**版本格式說明**:
- 主版本號：重大功能變更或架構調整
- 次版本號：新功能添加
- 修訂版本號：錯誤修復和小改進

**發布週期**:
- 穩定版本會標註版本號並發布
- 開發中的功能會在分支中進行

**支援**:
- 詳見 `部署指南.md` 和相關文件
