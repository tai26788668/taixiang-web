# 實作計畫

- [x] 1. 建立專案結構和核心介面





  - 建立React前端和Node.js後端的目錄結構
  - 設定TypeScript配置和基本依賴套件
  - 建立基本的型別定義和介面
  - _需求: 1.1, 2.1, 7.1_

- [x] 2. 實作CSV資料處理服務





  - [x] 2.1 建立CSV讀寫工具函數


    - 實作CSV檔案讀取和寫入功能
    - 處理檔案編碼和特殊字元
    - _需求: 7.1, 7.2, 7.3_

  - [x] 2.2 撰寫CSV往返一致性屬性測試


    - **屬性 16: CSV資料往返一致性**
    - **驗證: 需求 7.1, 7.2, 7.3**

  - [x] 2.3 實作個人資料CSV處理


    - 建立個人資料模型和驗證
    - 實作讀取和查詢功能
    - _需求: 7.1_

  - [x] 2.4 實作請假記錄CSV處理


    - 建立請假記錄模型和驗證
    - 實作CRUD操作功能
    - _需求: 7.2_

- [x] 3. 建立驗證和權限系統





  - [x] 3.1 實作JWT驗證服務


    - 建立JWT token生成和驗證功能
    - 實作會話管理中介軟體
    - _需求: 1.3_

  - [x] 3.2 撰寫登入憑證驗證屬性測試


    - **屬性 2: 登入憑證驗證**
    - **驗證: 需求 1.2**

  - [x] 3.3 實作權限控制中介軟體


    - 建立權限檢查邏輯
    - 實作管理者權限驗證
    - _需求: 4.1, 4.2_

  - [x] 3.4 撰寫權限控制屬性測試


    - **屬性 11: 權限控制**
    - **驗證: 需求 4.1, 4.2**

- [x] 4. 實作後端API路由




  - [x] 4.1 建立驗證API端點


    - 實作登入和登出功能
    - 處理登入成功和失敗情況
    - _需求: 1.2, 1.3, 1.4_

  - [x] 4.2 撰寫登入流程屬性測試


    - **屬性 3: 成功登入會話建立**
    - **屬性 4: 登入失敗處理**
    - **驗證: 需求 1.3, 1.4**

  - [x] 4.3 建立請假申請API端點


    - 實作請假申請提交功能
    - 實作請假時數計算邏輯（包含休息時間扣除）
    - _需求: 2.3, 2.4, 2.5, 2.6, 2.7_

  - [x] 4.4 更新請假時數計算邏輯以包含休息時間扣除





    - 實作每日12:00-12:30和16:30-17:00休息時間識別
    - 實作休息時間扣除邏輯，上限0.5小時
    - 更新dateUtils.ts中的時數計算函數
    - _需求: 2.5, 2.6, 2.7_

  - [x] 4.5 撰寫休息時間計算屬性測試




    - **屬性 7: 請假時數計算**
    - **屬性 17: 休息時間識別**  
    - **屬性 18: 休息時間扣除上限**
    - **驗證: 需求 2.5, 2.6, 2.7**

  - [x] 4.6 建立請假查詢API端點


    - 實作個人請假記錄查詢
    - 實作篩選和統計功能
    - _需求: 3.2, 3.3, 3.4, 3.5_

  - [x] 4.7 撰寫資料篩選邏輯屬性測試


    - **屬性 8: 資料篩選邏輯**
    - **屬性 9: 員工資料隔離**
    - **屬性 10: 請假統計計算**
    - **驗證: 需求 3.2, 3.3, 3.4, 3.5**

- [x] 5. 建立管理功能API





  - [x] 5.1 實作請假管理API端點


    - 建立管理者查詢所有請假記錄功能
    - 實作記錄更新和審核功能
    - _需求: 4.3, 4.5_

  - [x] 5.2 撰寫記錄更新屬性測試


    - **屬性 12: 記錄更新時間戳記**
    - **驗證: 需求 4.5**

  - [x] 5.3 實作CSV匯出功能


    - 建立資料匯出邏輯
    - 實作檔案命名和下載功能
    - _需求: 5.1, 5.2_

  - [x] 5.4 撰寫CSV匯出屬性測試


    - **屬性 13: CSV匯出內容一致性**
    - **驗證: 需求 5.1, 5.2**

- [x] 6. 檢查點 - 確保所有後端測試通過













  - 確保所有測試通過，如有問題請詢問使用者

- [x] 7. 建立前端基礎架構





  - [x] 7.1 設定React路由和版面配置


    - 建立路由配置和受保護路由
    - 實作共用版面配置組件
    - _需求: 1.1_

  - [x] 7.2 撰寫未驗證使用者重導向屬性測試



    - **屬性 1: 未驗證使用者重導向**
    - **驗證: 需求 1.1**

  - [x] 7.3 建立多語言支援系統


    - 設定i18next和語言檔案
    - 實作語言切換功能
    - _需求: 6.1, 6.2_

  - [x] 7.4 撰寫多語言功能屬性測試


    - **屬性 14: 多語言文字更新**
    - **屬性 15: 資料格式語言無關性**
    - **驗證: 需求 6.2, 6.3**

- [x] 8. 實作登入頁面




  - [x] 8.1 建立登入表單組件


    - 實作使用者介面和表單驗證
    - 整合API呼叫和錯誤處理
    - _需求: 1.1, 1.2, 1.4_

  - [x] 8.2 撰寫登入表單單元測試


    - 測試表單驗證和提交邏輯
    - 測試錯誤處理和使用者回饋
    - _需求: 1.2, 1.4_

- [x] 9. 實作請假申請頁面





  - [x] 9.1 建立請假申請表單組件


    - 實作表單欄位和驗證邏輯
    - 實作自動填入和欄位控制
    - _需求: 2.1, 2.2_

  - [x] 9.2 撰寫請假申請表單屬性測試


    - **屬性 5: 請假申請表單初始化**
    - **屬性 6: 請假申請完整流程**
    - **驗證: 需求 2.1, 2.2, 2.3, 2.4**

  - [x] 9.3 整合請假申請API


    - 連接表單提交到後端API
    - 實作成功和錯誤處理
    - _需求: 2.3, 2.4_

- [x] 10. 實作請假紀錄頁面





  - [x] 10.1 建立請假紀錄查詢組件


    - 實作篩選表單和結果顯示
    - 實作統計資料計算和顯示
    - _需求: 3.1, 3.2, 3.4_

  - [x] 10.2 整合請假查詢API



    - 連接篩選功能到後端API
    - 實作資料載入和錯誤處理
    - _需求: 3.2, 3.3, 3.5_

  - [x] 10.3 撰寫請假紀錄頁面單元測試


    - 測試篩選功能和資料顯示
    - 測試統計計算和使用者互動
    - _需求: 3.2, 3.4_


- [x] 11. 實作請假管理頁面




  - [x] 11.1 建立請假管理查詢組件


    - 實作管理者篩選和記錄顯示
    - 實作記錄點選和編輯功能
    - _需求: 4.3, 4.4_

  - [x] 11.2 建立記錄編輯對話框


    - 實作記錄編輯表單
    - 實作更新提交和回饋
    - _需求: 4.4, 4.5_

  - [x] 11.3 整合管理API和匯出功能


    - 連接管理功能到後端API
    - 實作CSV匯出和下載
    - _需求: 4.3, 4.5, 5.1, 5.2_

  - [x] 11.4 撰寫請假管理頁面單元測試


    - 測試管理者功能和權限控制
    - 測試記錄編輯和匯出功能
    - _需求: 4.3, 4.4, 4.5, 5.1_

- [x] 12. 建立共用UI組件





  - [x] 12.1 實作基礎UI組件


    - 建立Button、Input、Select、Table組件
    - 實作響應式設計和樣式
    - _需求: 所有UI相關需求_

  - [x] 12.2 撰寫UI組件單元測試


    - 測試組件渲染和互動
    - 測試響應式行為和可訪問性
    - _需求: 所有UI相關需求_

- [x] 13. 整合測試和錯誤處理




  - [x] 13.1 實作全域錯誤處理


    - 建立錯誤邊界和錯誤顯示組件
    - 實作API錯誤處理和使用者回饋
    - _需求: 所有錯誤處理相關需求_

  - [x] 13.2 撰寫整合測試



    - 測試完整的使用者流程
    - 測試錯誤情況和邊界條件
    - _需求: 所有功能需求_

- [x] 14. 最終檢查點 - 確保所有測試通過



























  - 確保所有測試通過，如有問題請詢問使用者

- [x] 15. 實作自動登出功能





  - [x] 15.1 建立核心Hook和配置


    - 建立 `useAutoLogout` Hook 作為主要介面
    - 建立配置管理系統，支援環境變數和預設值
    - 整合現有的 `useAuth` Hook
    - _需求: 8.1, 12.1, 12.4, 11.5_

  - [x] 15.2 實作活動監控系統


    - 建立 `ActivityMonitor` 類別監控使用者活動
    - 實作事件監聽器（滑鼠、鍵盤、點擊、觸控）
    - 加入事件節流機制以優化效能
    - 處理瀏覽器分頁切換邏輯
    - _需求: 10.1, 10.2, 10.3, 10.4, 10.5_

  - [x] 15.3 實作計時器管理系統


    - 建立 `TimerManager` 類別管理閒置計時器
    - 實作計時器重置和超時邏輯
    - 處理計時器狀態持久化
    - _需求: 8.2, 8.3_

  - [x] 15.4 建立超時訊息組件


    - 建立 `TimeoutMessage` React 組件
    - 實作「你閒置已超出時間，請重新登入」訊息顯示
    - 加入「重新登入」按鈕
    - 實作3秒自動跳轉功能
    - 設計響應式UI適配不同螢幕尺寸
    - _需求: 8.4, 9.1, 9.2, 9.3, 9.4_

  - [x] 15.5 實作登出整合邏輯


    - 整合現有的 `logout` 函數
    - 實作自動登出清理邏輯
    - 加入登出原因訊息顯示
    - 處理登出後的頁面跳轉
    - _需求: 11.1, 11.2, 11.3, 11.4, 11.5_

  - [x] 15.6 建立配置管理系統


    - 建立 `ConfigurationManager` 類別
    - 實作環境變數讀取和預設值
    - 加入配置驗證和錯誤處理
    - 支援執行時配置更新
    - _需求: 12.1, 12.2, 12.3, 12.4_

  - [x] 15.7 整合到現有應用程式


    - 在 `AuthProvider` 中整合自動登出功能
    - 更新路由保護邏輯
    - 加入全域錯誤處理
    - 確保與現有認證流程相容
    - _需求: 8.1, 11.5_

  - [x] 15.8 加入錯誤處理和日誌


    - 實作錯誤邊界和降級機制
    - 加入詳細的除錯日誌
    - 處理瀏覽器相容性問題
    - 實作效能監控
    - _需求: 所有需求的錯誤處理_

  - [x] 15.9 效能優化和測試


    - 優化事件監聽器效能
    - 實作記憶體洩漏檢測
    - 加入效能監控指標
    - 進行壓力測試和長時間運行測試
    - _需求: 效能相關需求_

  - [ ]* 15.10 撰寫自動登出功能屬性測試
    - **屬性 17: 活動重置計時器一致性**
    - **屬性 18: 登出清理完整性**
    - **屬性 19: 配置更新即時性**
    - **屬性 20: 事件監聽一致性**
    - **驗證: 需求 8.2, 10.1-10.4, 11.1-11.3, 12.2**

- [x] 16. 自動登出功能檢查點 - 確保所有測試通過










  - 確保所有測試通過，如有問題請詢問使用者

- [x] 17. 實作時間選擇器改進功能





  - [x] 17.1 建立TimeSelector核心組件


    - 建立可重複使用的TimeSelector組件基礎結構
    - 實作時間選項生成邏輯（125個選項：當日96個+隔日29個）
    - 實作時間格式化和驗證功能
    - 建立組件的基本樣式和無障礙功能
    - _需求: 13.1, 13.2, 17.1, 17.3_

  - [x] 17.2 實作時間驗證和計算邏輯


    - 建立時間範圍驗證功能（結束時間晚於開始時間）
    - 實作請假時數計算邏輯（扣除休息時間，上限0.5小時）
    - 實作隔日時間解析和處理功能
    - 建立錯誤處理和訊息顯示機制
    - _需求: 15.3, 18.4, 18.6_

  - [x] 17.3 更新請假申請頁面


    - 替換LeaveApplication.tsx中的TimeInput組件為TimeSelector
    - 移除隔日勾選欄位和相關狀態管理
    - 調整表單欄位順序（假別移到事由之前）
    - 整合新的時間驗證和計算邏輯
    - 更新表單提交和錯誤處理邏輯
    - _需求: 13.1, 13.2, 18.1, 19.1, 19.2_

  - [x] 17.4 更新請假管理頁面


    - 替換LeaveManagement.tsx編輯對話框中的TimeInput組件
    - 移除編輯表單中的隔日勾選欄位
    - 調整編輯表單的欄位順序
    - 確保預設值正確顯示和更新邏輯正常運作
    - _需求: 14.1, 14.2, 14.3, 14.4, 19.3_

  - [x] 17.5 確保資料相容性和儲存


    - 驗證時間選擇器產生的資料格式與現有CSV結構相容
    - 實作隔日時間標記的正確儲存和讀取
    - 更新API端點以處理新的時間格式
    - 確保向後相容性和資料遷移
    - _需求: 15.5, 18.5_

  - [x] 17.6 實作使用者體驗優化


    - 加入鍵盤導航功能（快速定位時間選項）
    - 優化行動裝置的觸控體驗
    - 實作無障礙功能支援（ARIA標籤、螢幕閱讀器支援）
    - 加入載入狀態和錯誤回饋機制
    - _需求: 16.3, 16.4, 16.5_

  - [x] 17.7 建立降級和錯誤處理機制


    - 實作TimeSelector載入失敗時的降級策略
    - 建立完整的錯誤處理和使用者回饋系統
    - 加入效能監控和記憶體管理
    - 建立元件載入和初始化的錯誤恢復機制
    - _需求: 15.3, 17.2_

  - [x] 17.8 整合測試和品質保證


    - 執行完整的端對端測試流程
    - 進行跨瀏覽器相容性測試
    - 驗證響應式設計在不同螢幕尺寸下的表現
    - 進行效能測試和記憶體洩漏檢查
    - _需求: 16.1, 16.2, 16.5_

  - [ ]* 17.9 撰寫時間選擇器功能屬性測試
    - **屬性 21: 時間選項完整性**
    - **屬性 22: 時間格式一致性**
    - **屬性 23: 選擇值設定**
    - **屬性 24: 預設值顯示**
    - **屬性 25: 表單整合更新**
    - **屬性 26: 資料儲存相容性**
    - **屬性 27: 輸入驗證**
    - **屬性 28: 時數計算準確性**
    - **屬性 29: 鍵盤導航**
    - **屬性 30: 組件屬性響應**
    - **屬性 31: 隔日時間識別**
    - **屬性 32: 介面簡化**
    - **屬性 33: 時間範圍驗證**
    - **屬性 34: 表單欄位順序**
    - **驗證: 需求 13.3-13.5, 14.2-14.4, 15.1-15.5, 16.3-16.5, 17.2-17.5, 18.1-18.6, 19.1-19.3**

- [x] 18. 時間選擇器功能檢查點 - 確保所有測試通過




  - 確保所有測試通過，如有問題請詢問使用者