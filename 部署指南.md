# æ³°é„‰é£Ÿå“ç³»çµ±éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®éŒ„

1. [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
2. [éƒ¨ç½²å‰æº–å‚™](#éƒ¨ç½²å‰æº–å‚™)
3. [å¾Œç«¯éƒ¨ç½² (Web Service)](#å¾Œç«¯éƒ¨ç½²-web-service)
4. [å‰ç«¯éƒ¨ç½² (Static Site)](#å‰ç«¯éƒ¨ç½²-static-site)
5. [Persistent Disk è¨­å®š](#persistent-disk-è¨­å®š)
6. [LINE Bot è¨­å®š](#line-bot-è¨­å®š)
7. [åŠŸèƒ½æ¸¬è©¦](#åŠŸèƒ½æ¸¬è©¦)
8. [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)
9. [ç¶­è­·èˆ‡ç›£æ§](#ç¶­è­·èˆ‡ç›£æ§)

---

## ç³»çµ±æ¶æ§‹

æ³°é„‰é£Ÿå“ç³»çµ±åŒ…å«ä¸‰å€‹ä¸»è¦éƒ¨åˆ†ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ³°é„‰é£Ÿå“ç³»çµ±                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  ä¸»ç¶²ç«™      â”‚  â”‚  è«‹å‡ç³»çµ±    â”‚  â”‚  LINE Bot    â”‚ â”‚
â”‚  â”‚  (Static)    â”‚  â”‚  (Backend)   â”‚  â”‚  (Backend)   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Persistent Disk (/mnt/data)            â”‚  â”‚
â”‚  â”‚  - personal_data.csv                             â”‚  â”‚
â”‚  â”‚  - leave_records.csv                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€è¡“æ£§
- **ä¸»ç¶²ç«™**: React + TypeScript + Vite + Tailwind CSS
- **å¾Œç«¯**: Node.js + Express + TypeScript
- **LINE Bot**: LINE Messaging API
- **è³‡æ–™å„²å­˜**: CSV æª”æ¡ˆ (Persistent Disk)

---

## éƒ¨ç½²å‰æº–å‚™

### 1. ç¢ºèª GitHub å€‰åº«
ç¢ºä¿ä»£ç¢¼å·²æ¨é€åˆ° GitHubï¼š
```bash
git status
git push origin main
```

### 2. æº–å‚™ç’°å¢ƒè®Šæ•¸å€¼
æº–å‚™ä»¥ä¸‹è³‡è¨Šï¼š
- LINE Channel Access Token
- LINE Channel Secret
- LINE Group ID
- Gmail App Password
- JWT Secret

### 3. ç¢ºèª Domain Names
- å¾Œç«¯æœå‹™ï¼š`https://your-backend.onrender.com`
- å‰ç«¯ç¶²ç«™ï¼š`https://your-website.onrender.com`

---

## å¾Œç«¯éƒ¨ç½² (Web Service)

### æ­¥é©Ÿ 1: å»ºç«‹ Web Service

1. **ç™»å…¥ Render Dashboard**
   - å‰å¾€ [render.com](https://render.com)
   - é»æ“Š "New +" â†’ "Web Service"

2. **é€£æ¥ GitHub å€‰åº«**
   - é¸æ“‡ä½ çš„å€‰åº«
   - åˆ†æ”¯ï¼š`main`

3. **åŸºæœ¬è¨­å®š**
   ```
   Name: taixiang-server
   Root Directory: ./
   Build Command: cd server && npm install && npm run build
   Start Command: cd server && npm start
   ```

### æ­¥é©Ÿ 2: ç’°å¢ƒè®Šæ•¸è¨­å®š

åœ¨ "Environment" é é¢è¨­å®šï¼š

```bash
# åŸºæœ¬è¨­å®š
NODE_ENV=production
PORT=10000

# LINE Bot è¨­å®š
LINE_CHANNEL_ACCESS_TOKEN=ä½ çš„_LINE_TOKEN
LINE_CHANNEL_SECRET=ä½ çš„_LINE_SECRET
LINE_GROUP_ID=ä½ çš„_ç¾¤çµ„_ID

# Domain è¨­å®š
BACKEND_URL=https://taixiang-server.onrender.com
WEBSITE_URL=https://taixiang.onrender.com

# Email è¨­å®š
GMAIL_USER=tai26788668@gmail.com
GMAIL_APP_PASSWORD=ä½ çš„_APP_å¯†ç¢¼
BACKUP_EMAIL=tai26788668@gmail.com

# JWT è¨­å®š
JWT_SECRET=your-secret-key-here

# Persistent Disk (ä»˜è²»æ–¹æ¡ˆ)
PERSISTENT_DISK_PATH=/mnt/data
```

### æ­¥é©Ÿ 3: éƒ¨ç½²ä¸¦é©—è­‰

1. **ç­‰å¾…éƒ¨ç½²å®Œæˆ** (ç´„ 3-8 åˆ†é˜)

2. **æª¢æŸ¥å¥åº·ç‹€æ…‹**
   ```bash
   curl https://taixiang-server.onrender.com/api/health
   ```

3. **æ¸¬è©¦è«‹å‡ç³»çµ±**
   - è¨ªå•ï¼š`https://taixiang-server.onrender.com/leave_system`
   - æ‡‰è©²çœ‹åˆ°ç™»å…¥é é¢

---

## å‰ç«¯éƒ¨ç½² (Static Site)

### æ­¥é©Ÿ 1: å»ºç«‹ Static Site

1. **åœ¨ Render Dashboard**
   - é»æ“Š "New +" â†’ "Static Site"

2. **é€£æ¥ GitHub å€‰åº«**
   - é¸æ“‡ä½ çš„å€‰åº«
   - åˆ†æ”¯ï¼š`main`

3. **åŸºæœ¬è¨­å®š**
   ```
   Name: taixiang-website
   Root Directory: website
   Build Command: npm install && npm run build
   Publish Directory: dist
   ```

### æ­¥é©Ÿ 2: éƒ¨ç½²ä¸¦é©—è­‰

1. **ç­‰å¾…éƒ¨ç½²å®Œæˆ** (ç´„ 2-5 åˆ†é˜)

2. **æ¸¬è©¦ç¶²ç«™**
   - è¨ªå•ï¼š`https://taixiang.onrender.com`
   - ç¢ºèªæ‰€æœ‰é é¢æ­£å¸¸é¡¯ç¤º

---

## Persistent Disk è¨­å®š

### ç‚ºä»€éº¼éœ€è¦ Persistent Diskï¼Ÿ

Render çš„ Web Service ä½¿ç”¨è‡¨æ™‚æª”æ¡ˆç³»çµ±ï¼š
- âŒ æ¯æ¬¡éƒ¨ç½²æœƒé‡ç½®
- âŒ æœå‹™é‡å•Ÿæœƒé‡ç½®
- âŒ é‹è¡Œæ™‚å¯«å…¥çš„è³‡æ–™æœƒéºå¤±

ä½¿ç”¨ Persistent Diskï¼š
- âœ… è³‡æ–™æ°¸ä¹…ä¿å­˜
- âœ… éƒ¨ç½²æ™‚ä¸æœƒéºå¤±
- âœ… æœå‹™é‡å•Ÿæ™‚ä¸æœƒéºå¤±

### è²»ç”¨
- **1 GB Disk**: $1/æœˆ
- **å…è²»æ–¹æ¡ˆ**: ä¸æ”¯æ´ Persistent Disk

### è¨­å®šæ­¥é©Ÿ

#### 1. å‰µå»º Persistent Disk

1. **åœ¨ Render Dashboard**
   - é¸æ“‡ä½ çš„ Web Service
   - é»æ“Š "Disks" â†’ "Add Disk"

2. **å¡«å¯«è¨­å®š**
   ```
   Name: taixiang-data
   Mount Path: /mnt/data
   Size: 1 GB
   ```

3. **ç­‰å¾…å‰µå»ºå®Œæˆ** (1-2 åˆ†é˜)

#### 2. ä¸Šå‚³ CSV æª”æ¡ˆ

**æ–¹æ³•ï¼šä½¿ç”¨ SSH æ‰‹å‹•ä¸Šå‚³**

1. **é€£æ¥åˆ° Render Shell**
   ```bash
   ssh srv-xxxxx@ssh.singapore.render.com
   ```

2. **è¤‡è£½æª”æ¡ˆåˆ° Persistent Disk**
   ```bash
   cp /opt/render/project/src/server/data/personal_data.csv /mnt/data/
   cp /opt/render/project/src/server/data/leave_records.csv /mnt/data/
   ```

3. **é©—è­‰æª”æ¡ˆ**
   ```bash
   ls -la /mnt/data/
   head -n 3 /mnt/data/personal_data.csv
   head -n 3 /mnt/data/leave_records.csv
   ```

#### 3. æª”æ¡ˆçµæ§‹

```
/opt/render/project/src/server/
â”œâ”€â”€ data/                    # åˆå§‹è³‡æ–™ï¼ˆå”¯è®€ï¼‰
â”‚   â”œâ”€â”€ personal_data.csv
â”‚   â””â”€â”€ leave_records.csv
â””â”€â”€ dist/

/mnt/data/                   # Persistent Diskï¼ˆè®€å¯«ï¼‰
â”œâ”€â”€ personal_data.csv
â””â”€â”€ leave_records.csv
```

---

## LINE Bot è¨­å®š

### æ­¥é©Ÿ 1: æ›´æ–° Webhook URL

1. **å‰å¾€ LINE Developers Console**
   - ç¶²å€: https://developers.line.biz/console/

2. **é¸æ“‡ä½ çš„ Channel**
   - æ‰¾åˆ° Messaging API Channel

3. **æ›´æ–° Webhook URL**
   - åœ¨ "Messaging API" è¨­å®šä¸­
   - **Webhook URL**: `https://taixiang-server.onrender.com/line/webhook`
   - é»æ“Š "Verify" ç¢ºèªé€£æ¥æˆåŠŸ
   - ç¢ºä¿ "Use webhook" å·²å•Ÿç”¨

### æ­¥é©Ÿ 2: æ¸¬è©¦ LINE Bot

1. **å¥åº·æª¢æŸ¥**
   ```bash
   curl https://taixiang-server.onrender.com/line/health
   ```

2. **åœ¨ LINE ç¾¤çµ„æ¸¬è©¦**
   - ç™¼é€ `help?` æŸ¥çœ‹æŒ‡ä»¤åˆ—è¡¨
   - ç™¼é€ `list` æŸ¥çœ‹è«‹å‡è¨˜éŒ„

---

## åŠŸèƒ½æ¸¬è©¦

### åŸºæœ¬æœå‹™æ¸¬è©¦
- [ ] å¾Œç«¯å¥åº·æª¢æŸ¥ï¼š`/api/health`
- [ ] LINE Bot å¥åº·æª¢æŸ¥ï¼š`/line/health`
- [ ] è«‹å‡ç³»çµ±è¼‰å…¥ï¼š`/leave_system`
- [ ] ä¸»ç¶²ç«™è¼‰å…¥ï¼š`https://taixiang.onrender.com`

### è«‹å‡ç³»çµ±åŠŸèƒ½æ¸¬è©¦
- [ ] ç™»å…¥åŠŸèƒ½ (SS01/SS01)
- [ ] è«‹å‡ç”³è«‹
- [ ] è«‹å‡è¨˜éŒ„æŸ¥è©¢
- [ ] ç®¡ç†è€…åŠŸèƒ½
- [ ] è®Šæ›´å¯†ç¢¼

### LINE Bot åŠŸèƒ½æ¸¬è©¦
- [ ] `help?` - é¡¯ç¤ºå¹«åŠ©
- [ ] `list` - åˆ—å‡ºæœªä¾†è«‹å‡
- [ ] `list -d` - åˆ—å‡ºç•¶æ—¥è«‹å‡
- [ ] `list -a` - åˆ—å‡ºå·²ç°½æ ¸è«‹å‡
- [ ] `list -d -a` - åˆ—å‡ºç•¶æ—¥å·²ç°½æ ¸è«‹å‡
- [ ] `è«‹å‡` - é¡¯ç¤ºè«‹å‡ç³»çµ±é€£çµ
- [ ] `å®˜ç¶²` - é¡¯ç¤ºå®˜ç¶²é€£çµ

### å‚™ä»½åŠŸèƒ½æ¸¬è©¦
- [ ] å‚™ä»½ç‹€æ…‹ï¼š`/api/backup/status`
- [ ] ä¸‹è¼‰è«‹å‡è¨˜éŒ„ï¼š`/api/backup/emergency-download?file=leave-records`
- [ ] ä¸‹è¼‰å€‹äººè³‡æ–™ï¼š`/api/backup/emergency-download?file=personal-data`

---

## æ•…éšœæ’é™¤

### å•é¡Œ 1: å‰ç«¯é é¢ 404/502

**ç—‡ç‹€**: è¨ªå•è«‹å‡ç³»çµ±å‡ºç¾éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆ**:
1. æª¢æŸ¥ Build Command æ˜¯å¦æ­£ç¢º
2. æª¢æŸ¥ Root Directory è¨­ç‚º `./`
3. æŸ¥çœ‹éƒ¨ç½²æ—¥èªŒç¢ºèªå‰ç«¯å»ºç½®æˆåŠŸ
4. é‡æ–°éƒ¨ç½²æœå‹™

### å•é¡Œ 2: LINE Bot ç„¡å›æ‡‰

**ç—‡ç‹€**: LINE Bot ä¸å›æ‡‰è¨Šæ¯

**è§£æ±ºæ–¹æ¡ˆ**:
1. æª¢æŸ¥ Webhook URL æ˜¯å¦æ­£ç¢º
2. ç¢ºèª LINE Token å’Œ Secret æ­£ç¢º
3. æª¢æŸ¥ `/line/health` ç«¯é»ç‹€æ…‹
4. æŸ¥çœ‹æœå‹™æ—¥èªŒä¸­çš„éŒ¯èª¤è¨Šæ¯

### å•é¡Œ 3: ç™»å…¥å¤±æ•—

**ç—‡ç‹€**: è«‹å‡ç³»çµ±ç™»å…¥æ™‚å‡ºç¾"ç³»çµ±éŒ¯èª¤"

**è§£æ±ºæ–¹æ¡ˆ**:
1. ç¢ºèª Persistent Disk å·²è¨­å®š
2. ç¢ºèª CSV æª”æ¡ˆå·²ä¸Šå‚³åˆ° `/mnt/data/`
3. æª¢æŸ¥ç’°å¢ƒè®Šæ•¸ `PERSISTENT_DISK_PATH=/mnt/data`
4. æŸ¥çœ‹æœå‹™æ—¥èªŒç¢ºèªæª”æ¡ˆè·¯å¾‘

### å•é¡Œ 4: CORS éŒ¯èª¤

**ç—‡ç‹€**: å‰ç«¯ç„¡æ³•é€£æ¥åˆ°å¾Œç«¯ API

**è§£æ±ºæ–¹æ¡ˆ**:
1. ç¢ºèª `WEBSITE_URL` ç’°å¢ƒè®Šæ•¸æ­£ç¢º
2. æª¢æŸ¥ CORS è¨­å®šæ˜¯å¦åŒ…å«å‰ç«¯ domain
3. ç¢ºèªå‰ç«¯å’Œå¾Œç«¯éƒ½å·²æ­£ç¢ºéƒ¨ç½²

### å•é¡Œ 5: è³‡æ–™éºå¤±

**ç—‡ç‹€**: è«‹å‡è¨˜éŒ„åœ¨é‡å•Ÿå¾Œæ¶ˆå¤±

**è§£æ±ºæ–¹æ¡ˆ**:
1. å‡ç´šåˆ°ä»˜è²»æ–¹æ¡ˆä¸¦ä½¿ç”¨ Persistent Disk
2. æˆ–è€ƒæ…®é·ç§»åˆ° PostgreSQL è³‡æ–™åº«
3. å®šæœŸä½¿ç”¨å‚™ä»½ API ä¸‹è¼‰è³‡æ–™

---

## ç¶­è­·èˆ‡ç›£æ§

### å®šæœŸæª¢æŸ¥
- æ¯é€±æ¸¬è©¦ä¸»è¦åŠŸèƒ½
- ç›£æ§ Render æœå‹™ç‹€æ…‹
- æª¢æŸ¥ LINE Bot å›æ‡‰
- æŸ¥çœ‹éŒ¯èª¤æ—¥èªŒ

### å‚™ä»½ç­–ç•¥
- è¨­å®šè‡ªå‹•åŒ–é€±å ±ç™¼é€
- å®šæœŸä¸‹è¼‰ç·Šæ€¥å‚™ä»½
- ç›£æ§è³‡æ–™å®Œæ•´æ€§

### æ›´æ–°æµç¨‹
1. åœ¨æœ¬åœ°æ¸¬è©¦è®Šæ›´
2. æäº¤åˆ° GitHub
3. Render è‡ªå‹•éƒ¨ç½²
4. é©—è­‰åŠŸèƒ½æ­£å¸¸

### ç›£æ§å·¥å…·

#### å¥åº·æª¢æŸ¥
```bash
# å¾Œç«¯å¥åº·æª¢æŸ¥
curl https://taixiang-server.onrender.com/api/health

# LINE Bot å¥åº·æª¢æŸ¥
curl https://taixiang-server.onrender.com/line/health

# å‚™ä»½ç‹€æ…‹æª¢æŸ¥
curl -H "User-Agent: TaiXiang-Emergency-Backup-Tool" \
     "https://taixiang-server.onrender.com/api/backup/status"
```

#### æ—¥èªŒæŸ¥çœ‹
- åœ¨ Render Dashboard çš„ "Logs" é é¢æŸ¥çœ‹å³æ™‚æ—¥èªŒ
- æœå°‹éŒ¯èª¤è¨Šæ¯å’Œç•°å¸¸

### æˆæœ¬ä¼°ç®—

| é …ç›® | å…è²»æ–¹æ¡ˆ | ä»˜è²»æ–¹æ¡ˆ |
|------|---------|---------|
| Web Service | $0/æœˆ | $7/æœˆ |
| Static Site | $0/æœˆ | $0/æœˆ |
| Persistent Disk (1GB) | ä¸æ”¯æ´ | $1/æœˆ |
| **ç¸½è¨ˆ** | **$0/æœˆ** | **$8/æœˆ** |

---

## å¿«é€Ÿéƒ¨ç½²æŒ‡ä»¤

```bash
# 1. ç¢ºèªä»£ç¢¼å·²æ¨é€
git status
git push origin main

# 2. åœ¨ Render å»ºç«‹æœå‹™
# - å¾Œç«¯ Web Service (Root: ./, Build: cd server && npm install && npm run build)
# - å‰ç«¯ Static Site (Root: website, Build: npm install && npm run build)

# 3. è¨­å®šç’°å¢ƒè®Šæ•¸ (è¦‹ä¸Šæ–¹æ¸…å–®)

# 4. æ›´æ–° LINE Bot Webhook URL
# https://taixiang-server.onrender.com/line/webhook

# 5. ä¸Šå‚³ CSV æª”æ¡ˆåˆ° Persistent Disk (å¦‚æœä½¿ç”¨ä»˜è²»æ–¹æ¡ˆ)
ssh srv-xxxxx@ssh.singapore.render.com
cp /opt/render/project/src/server/data/*.csv /mnt/data/

# 6. æ¸¬è©¦éƒ¨ç½²
curl https://taixiang-server.onrender.com/api/health
```

---

## ç›¸é—œè³‡æº

- **Render å®˜æ–¹æ–‡æª”**: https://render.com/docs
- **LINE Developers Console**: https://developers.line.biz/console/
- **GitHub å€‰åº«**: ä½ çš„å€‰åº« URL

---

**æœ€å¾Œæ›´æ–°**: 2026-02-06  
**ç‰ˆæœ¬**: 3.0.1

**éƒ¨ç½²å®Œæˆå¾Œï¼Œä½ çš„æ³°é„‰é£Ÿå“ç³»çµ±å°±æœƒåœ¨æ–°çš„ URL ä¸Šç·šäº†ï¼** ğŸ‰

---

## ç‰ˆæœ¬æ›´æ–°è¨˜éŒ„

### v3.0.1 (2026-02-06)
- âœ… CSV æª”æ¡ˆé‡æ–°å‘½åç‚ºè‹±æ–‡ï¼ˆpersonal_data.csv, leave_records.csvï¼‰
- âœ… ç§»é™¤è‡ªå‹•ä¸Šå‚³ CSV çš„ç¨‹å¼ç¢¼ï¼Œæ”¹ç‚ºæ‰‹å‹•ä¸Šå‚³
- âœ… æ•´åˆæ‰€æœ‰éƒ¨ç½²ç›¸é—œæ–‡æª”åˆ°å–®ä¸€æŒ‡å—
- âœ… çµ±ä¸€éƒ¨ç½²è…³æœ¬ (server/deploy.sh)
- âœ… ä¿®å¾©å‰ç«¯æª”æ¡ˆè·¯å¾‘å•é¡Œ
- âœ… æ”¹å–„ Persistent Disk åˆå§‹åŒ–
